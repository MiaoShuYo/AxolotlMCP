# 基础可观测性（日志 + 指标）

本文档介绍 AxolotlMCP 的最小可用可观测性：结构化日志与基础指标。

## 日志

- 服务端与客户端均使用 `Microsoft.Extensions.Logging`，默认可接入控制台日志。
- 关键路径：
  - 服务器启动/停止日志（`McpServer`）
  - 入站消息处理异常的错误日志

## 指标

指标定义在 `AxolotlMCP.Core.Observability.McpMetrics` 中：

- `mcp.server.requests.received`：请求计数 Counter
- `mcp.server.notifications.received`：通知计数 Counter
- `mcp.server.responses.sent`：响应计数 Counter
- `mcp.errors`：错误计数 Counter
- `mcp.request.latency`：请求端到端耗时（毫秒）Histogram

服务器在处理循环中埋点：

```csharp
var started = Stopwatch.GetTimestamp();
// ... 处理请求 ...
McpMetrics.RequestsReceived.Add(1);
McpMetrics.ResponsesSent.Add(1);
var elapsedMs = (Stopwatch.GetTimestamp() - started) * 1000.0 / Stopwatch.Frequency;
McpMetrics.RequestLatencyMs.Record(elapsedMs);
```

## 导出与集成

- 可以通过 OpenTelemetry Metrics Provider 收集并导出到 Prometheus/OTLP。
- 后续可扩展 tracing 与更丰富的标签维度（方法名、状态码）。


