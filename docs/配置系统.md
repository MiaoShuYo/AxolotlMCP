# 配置系统（Options）

本文档介绍服务端与客户端的集中化配置方案，支持 `appsettings.json` 与环境变量绑定。

## 配置项

- Mcp:Server
  - ShutdownWaitSeconds：优雅关闭等待秒数。
  - LogStartupMessage：是否在启动时记录一条日志。
- Mcp:RateLimit
  - PermitLimit：并发许可上限。
  - QueueLimit：等待队列上限。
- Mcp:Client
  - MaxConcurrentRequests：并发上限（0 表示不限制）。
  - DefaultRequestTimeoutSeconds：默认超时（秒）。
  - MaxRetries：最大重试次数。
  - RetryBackoffBaseMs：指数退避基数（毫秒）。

## 示例 appsettings

参见 `samples/appsettings.sample.json`：

```
{
  "Mcp": {
    "Server": {
      "ShutdownWaitSeconds": 2,
      "LogStartupMessage": true
    },
    "RateLimit": {
      "PermitLimit": 64,
      "QueueLimit": 256
    },
    "Client": {
      "MaxConcurrentRequests": 16,
      "DefaultRequestTimeoutSeconds": 20,
      "MaxRetries": 2,
      "RetryBackoffBaseMs": 200
    }
  }
}
```

## 绑定方式

- 服务端：`services.AddMcpServer(ctx.Configuration)` 会自动绑定 `Mcp:Server` 到 `ServerOptions`。
- 客户端：可在创建 `McpClient` 时读取 `IConfiguration` 并构造 `ClientOptions` 传入。

## 环境变量覆盖

- 支持 `Mcp__Server__ShutdownWaitSeconds=5` 这类双下划线分隔的环境变量覆盖。


